<template>
  <v-container grid-list-xl fluid app>
    <v-layout align-center justify-center :class="{singleLine:singleLine}">
      <v-flex xs12 md8 xl6>
        <v-card>
          <v-toolbar flat dense   color="transparent">
            <v-toolbar-title>{{title}}</v-toolbar-title>
            <v-spacer></v-spacer>
            <v-btn icon @click="refresh" title="刷新">
              <v-icon>refresh</v-icon>
            </v-btn>
            <v-menu offset-y>
              <v-btn icon slot="activator" title="设置">
                <v-icon>more_vert</v-icon>
              </v-btn>
              <v-list>
                <v-list-item>
                  <v-list-item-action>
                    <v-checkbox v-model="singleLine"></v-checkbox>
                  </v-list-item-action>
                  <v-list-item-content @click="singleLine=!singleLine">
                    <v-list-item-title>{{'单行布局'}}</v-list-item-title>
                  </v-list-item-content>
                </v-list-item>
              </v-list>
            </v-menu>
            <v-btn icon @click="cancel" title="关闭">
              <v-icon>close</v-icon>
            </v-btn>
          </v-toolbar>
          <v-divider></v-divider>
          <v-form ref="form">
            <v-card-text>
              <div class="dialog-page">
                <component :is="singleLine?'span':'v-layout'" wrap>
                  <Input
                    v-for="(item) in options"
                    v-bind="item"
                    v-model="form[item.Description]"
                    :key="item.Description"
                    :singleLine="singleLine"
                    canEdit
                  />
                </component>
              </div>
            </v-card-text>
          </v-form>

          <v-card-actions>
            <v-btn text @click="cancel">取消</v-btn>
            <v-spacer></v-spacer>
            <v-btn color="primary" text @click="query">查询</v-btn>
          </v-card-actions>
        </v-card>
      </v-flex>
    </v-layout>
  </v-container>
</template>

<script>
import VuePerfectScrollbar from "vue-perfect-scrollbar";
import Input from "@/components/Inputs";
export default { 
  components: { VuePerfectScrollbar, Input },
  props: {
    title: String,
    options: Array
  },
  data() {
    return {
      singleLine: false,
      form: null
    };
  },
  created() {
    this.load();
  },
  methods: {
    load() {
      let form = {};
      for (let index = 0; index < this.options.length; index++) {
        const opt = this.options[index];
        form[opt.Description] = opt.value;
      }
      this.form = form;
    },
    refresh() {
      for (const option of this.options) {
        option.value = null;
      }
      this.load(); 
    },
    query() {
      for (let index = 0; index < this.options.length; index++) {
        const opt = this.options[index];
        opt.value = this.form[opt.Description];
      }

      let val = this.options
        .filter(r => r.value)
        .map(r => {
          return {
            Name: r.Name,
            compare: r.compare,
            value: Array.isArray(r.value) ? r.value.join(",") : r.value
          };
        });
      this.$emit("success", val);
    },
    cancel() {
      this.$emit("close");
    }
  }
};
</script>

<style scoped>
.dialog-page {
  height: calc(100vh - 265px);
  overflow: auto;
  padding: 12px;
}
</style>
